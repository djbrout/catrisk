<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CatRisk - Hurricane Protection</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #ffffff;
      color: #1a1a1a;
      min-height: 100vh;
    }

    /* Navigation */
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      border-bottom: 1px solid #e5e5e5;
      background: #fff;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
    }

    .logo span {
      color: #f97316;
    }

    .connect-btn {
      background: #1a1a1a;
      color: #fff;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
    }

    /* Main Container */
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Landing Page */
    .landing {
      min-height: 70vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .landing h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .landing .subtitle {
      color: #666;
      font-size: 1.1rem;
      margin-bottom: 3rem;
    }

    .choice-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      max-width: 700px;
      width: 100%;
    }

    .choice-card {
      background: #fff;
      border: 2px solid #e5e5e5;
      border-radius: 16px;
      padding: 2.5rem 2rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .choice-card:hover {
      border-color: #f97316;
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }

    .choice-card.protection:hover {
      border-color: #16a34a;
    }

    .choice-card.yield:hover {
      border-color: #2563eb;
    }

    .choice-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .choice-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .choice-card.protection .choice-title {
      color: #16a34a;
    }

    .choice-card.yield .choice-title {
      color: #2563eb;
    }

    .choice-desc {
      color: #666;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .choice-highlight {
      margin-top: 1.5rem;
      padding: 1rem;
      border-radius: 8px;
      font-weight: 600;
    }

    .choice-card.protection .choice-highlight {
      background: #f0fdf4;
      color: #166534;
    }

    .choice-card.yield .choice-highlight {
      background: #eff6ff;
      color: #1e40af;
    }

    /* Hidden by default */
    .protection-content,
    .yield-content {
      display: none;
    }

    .protection-content.active,
    .yield-content.active {
      display: block;
    }

    .landing.hidden {
      display: none;
    }

    /* Back button */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: #666;
      font-size: 0.9rem;
      cursor: pointer;
      margin-bottom: 1rem;
      padding: 0.5rem 0;
    }

    .back-btn:hover {
      color: #1a1a1a;
    }

    /* Section styles */
    .page-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .page-header h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .page-header p {
      color: #666;
    }

    /* Search Section */
    .search-section {
      max-width: 500px;
      margin: 1.5rem auto;
    }

    .search-wrapper {
      display: flex;
      gap: 0.5rem;
    }

    .search-input {
      flex: 1;
      background: #fff;
      border: 1px solid #ddd;
      padding: 0.8rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
    }

    .search-input:focus {
      outline: none;
      border-color: #f97316;
    }

    .search-btn {
      background: #f97316;
      color: #fff;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
    }

    .search-btn:hover {
      background: #ea580c;
    }

    /* Map Section */
    .map-section {
      margin: 2rem 0;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #e5e5e5;
    }

    #map {
      height: 300px;
      width: 100%;
    }

    .map-info {
      background: #f9f9f9;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .map-location {
      font-weight: 500;
    }

    .map-location span {
      color: #666;
      font-weight: 400;
      font-size: 0.9rem;
    }

    .map-radius {
      color: #f97316;
      font-weight: 500;
    }

    /* Coverage Status */
    .coverage-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      margin: 1rem 0;
    }

    .coverage-status.covered {
      background: #f0fdf4;
      color: #166534;
    }

    .coverage-status.not-covered {
      background: #fef2f2;
      color: #991b1b;
    }

    .status-icon {
      font-size: 1.2rem;
    }

    /* How it works steps */
    .steps {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin: 2rem 0;
      padding: 1.5rem;
      background: #f9f9f9;
      border-radius: 12px;
    }

    .step {
      text-align: center;
    }

    .step-num {
      width: 36px;
      height: 36px;
      background: #16a34a;
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin: 0 auto 0.75rem;
    }

    .step-title {
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .step-desc {
      color: #666;
      font-size: 0.85rem;
    }

    /* Market Card */
    .market-card {
      background: #fff;
      border: 2px solid #16a34a;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .market-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .market-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .market-prob {
      color: #f97316;
      font-weight: 600;
    }

    .detail-box {
      background: #f0fdf4;
      padding: 1.25rem;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 1rem;
    }

    .detail-label {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 0.25rem;
    }

    .detail-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #16a34a;
    }

    .btn {
      padding: 0.75rem;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      font-size: 1rem;
      border: none;
      width: 100%;
    }

    .btn-primary {
      background: #16a34a;
      color: #fff;
    }

    .btn-secondary {
      background: #2563eb;
      color: #fff;
    }

    .btn:hover {
      opacity: 0.9;
    }

    /* Yield Section */
    .yield-steps {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      margin: 2rem 0;
      padding: 1.5rem;
      background: #eff6ff;
      border-radius: 12px;
    }

    .yield-steps .step-num {
      background: #2563eb;
    }

    .section-desc {
      color: #666;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .yield-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .yield-card {
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      padding: 1.5rem;
      position: relative;
    }

    .yield-card.featured {
      border: 2px solid #2563eb;
      background: #eff6ff;
    }

    .featured-badge {
      position: absolute;
      top: -10px;
      right: 16px;
      background: #2563eb;
      color: #fff;
      font-size: 0.7rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
    }

    .yield-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .yield-title {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .yield-apy {
      font-size: 1.5rem;
      font-weight: 700;
      color: #2563eb;
    }

    .yield-apy span {
      font-size: 0.8rem;
      font-weight: 400;
      color: #666;
    }

    .yield-desc {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      line-height: 1.4;
    }

    .yield-stats {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 1rem;
    }

    .yield-stat-value {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .yield-stat-label {
      font-size: 0.75rem;
      color: #888;
    }

    .yield-detail {
      background: #fff;
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border: 1px solid #dbeafe;
    }

    .yield-detail-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-bottom: 0.4rem;
    }

    .yield-detail-row:last-child {
      margin-bottom: 0;
    }

    .green { color: #16a34a; }
    .red { color: #dc2626; }

    /* Footer */
    footer {
      margin-top: 3rem;
      padding: 2rem;
      border-top: 1px solid #e5e5e5;
      text-align: center;
      color: #888;
      font-size: 0.85rem;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: #fff;
      border-radius: 12px;
      padding: 1.5rem;
      width: 100%;
      max-width: 400px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .modal-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #888;
    }

    .input-group {
      margin-bottom: 1rem;
    }

    .input-label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      color: #666;
    }

    .amount-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1.1rem;
    }

    .amount-input:focus {
      outline: none;
      border-color: #f97316;
    }

    .payout-preview {
      background: #f0fdf4;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .payout-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .payout-row:last-child {
      margin-bottom: 0;
      padding-top: 0.5rem;
      border-top: 1px solid #dcfce7;
      font-weight: 600;
    }

    .confirm-btn {
      width: 100%;
      padding: 0.75rem;
      background: #16a34a;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      font-size: 1rem;
      cursor: pointer;
    }

    /* Basket Info */
    .basket-info {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .basket-header {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .basket-desc {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 0.75rem;
    }

    .basket-zips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .zip-tag {
      background: #fff;
      border: 1px solid #ddd;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      color: #666;
    }

    @media (max-width: 768px) {
      .choice-cards {
        grid-template-columns: 1fr;
      }
      .steps {
        grid-template-columns: repeat(2, 1fr);
      }
      .yield-steps {
        grid-template-columns: 1fr;
      }
      .yield-cards {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav>
    <div class="logo" onclick="showLanding()">Cat<span>Risk</span></div>
    <button class="connect-btn">Connect Wallet</button>
  </nav>

  <div class="container">
    <!-- Landing Page -->
    <div class="landing" id="landing">
      <h1>CatRisk</h1>
      <p class="subtitle">Decentralized hurricane protection powered by prediction markets</p>

      <div class="choice-cards">
        <div class="choice-card protection" onclick="showProtection()">
          <div class="choice-icon">üõ°Ô∏è</div>
          <div class="choice-title">I Need Protection</div>
          <div class="choice-desc">
            Protect your property against hurricane damage. Pay a small premium, get paid if a hurricane hits your area.
          </div>
          <div class="choice-highlight">
            $1,000 ‚Üí $25,000 if hurricane hits
          </div>
        </div>

        <div class="choice-card yield" onclick="showYield()">
          <div class="choice-icon">üìà</div>
          <div class="choice-title">I Want to Earn Yield</div>
          <div class="choice-desc">
            Provide liquidity to protection buyers. Earn yield when hurricanes don't hit the covered areas.
          </div>
          <div class="choice-highlight">
            Earn 8% APY on your USDC
          </div>
        </div>
      </div>
    </div>

    <!-- Protection Content -->
    <div class="protection-content" id="protection-content">
      <div class="back-btn" onclick="showLanding()">‚Üê Back to home</div>

      <div class="page-header">
        <h1>Hurricane Protection</h1>
        <p>Enter your location to see available coverage</p>
      </div>

      <!-- Search -->
      <div class="search-section">
        <div class="search-wrapper">
          <input type="text" class="search-input" id="address-input" placeholder="Enter your ZIP code or address" value="33139">
          <button class="search-btn" onclick="searchLocation()">Search</button>
        </div>
      </div>

      <!-- Map -->
      <div class="map-section">
        <div id="map"></div>
        <div class="map-info">
          <div class="map-location" id="location-text">
            Miami Beach, FL <span>ZIP 33139</span>
          </div>
          <div class="map-radius" id="radius-text">15 mile radius</div>
        </div>
      </div>

      <!-- Coverage Status -->
      <div class="coverage-status covered" id="coverage-status">
        <span class="status-icon">‚úì</span>
        <span>Your address is within the coverage area</span>
      </div>

      <!-- How it works -->
      <div class="steps">
        <div class="step">
          <div class="step-num">1</div>
          <div class="step-title">Enter ZIP</div>
          <div class="step-desc">Find markets for your location</div>
        </div>
        <div class="step">
          <div class="step-num">2</div>
          <div class="step-title">Buy Protection</div>
          <div class="step-desc">Pay premium in USDC</div>
        </div>
        <div class="step">
          <div class="step-num">3</div>
          <div class="step-title">Wait</div>
          <div class="step-desc">Hurricane season: Jun-Nov</div>
        </div>
        <div class="step">
          <div class="step-num">4</div>
          <div class="step-title">Get Paid</div>
          <div class="step-desc">Automatic payout if triggered</div>
        </div>
      </div>

      <!-- Market Card -->
      <div class="market-card">
        <div class="market-header">
          <div class="market-title">Cat 3+ Hurricane within 15 miles</div>
          <div class="market-prob">4¬¢ <span style="color:#888;font-weight:400;font-size:0.8rem;">(4% implied)</span></div>
        </div>

        <div class="detail-box">
          <div class="detail-label">If hurricane hits your area</div>
          <div class="detail-value">$1,000 protection yields $25,000</div>
        </div>

        <button class="btn btn-primary" onclick="showModal()">Buy Protection</button>
      </div>
    </div>

    <!-- Yield Content -->
    <div class="yield-content" id="yield-content">
      <div class="back-btn" onclick="showLanding()">‚Üê Back to home</div>

      <div class="page-header">
        <h1>Earn Yield</h1>
        <p>Provide liquidity and earn when hurricanes don't hit</p>
      </div>

      <!-- How it works for yield -->
      <div class="yield-steps">
        <div class="step">
          <div class="step-num">1</div>
          <div class="step-title">Deposit USDC</div>
          <div class="step-desc">Choose single ZIP or diversified basket</div>
        </div>
        <div class="step">
          <div class="step-num">2</div>
          <div class="step-title">Earn Yield</div>
          <div class="step-desc">8% APY from protection premiums</div>
        </div>
        <div class="step">
          <div class="step-num">3</div>
          <div class="step-title">Withdraw</div>
          <div class="step-desc">After hurricane season ends</div>
        </div>
      </div>

      <p class="section-desc">Take the other side of protection buyers. Your deposit backs their coverage.</p>

      <div class="yield-cards">
        <!-- Single ZIP -->
        <div class="yield-card">
          <div class="yield-header">
            <div class="yield-title">Single ZIP</div>
            <div class="yield-apy">8.3% <span>APY</span></div>
          </div>
          <div class="yield-desc">
            Provide liquidity for one ZIP code. Higher risk, higher reward.
          </div>
          <div class="yield-stats">
            <div class="yield-stat">
              <div class="yield-stat-value">4%</div>
              <div class="yield-stat-label">Risk of loss</div>
            </div>
            <div class="yield-stat">
              <div class="yield-stat-value">1</div>
              <div class="yield-stat-label">ZIP code</div>
            </div>
          </div>
          <button class="btn btn-secondary" onclick="showYieldModal('single')">Select ZIP</button>
        </div>

        <!-- Diversified Basket -->
        <div class="yield-card featured">
          <div class="featured-badge">RECOMMENDED</div>
          <div class="yield-header">
            <div class="yield-title">Diversified Basket</div>
            <div class="yield-apy">8% <span>APY</span></div>
          </div>
          <div class="yield-desc">
            Spread across 50+ ZIP codes. Diversification reduces risk while maintaining yield.
          </div>
          <div class="yield-stats">
            <div class="yield-stat">
              <div class="yield-stat-value">&lt;1%</div>
              <div class="yield-stat-label">Risk of total loss</div>
            </div>
            <div class="yield-stat">
              <div class="yield-stat-value">50+</div>
              <div class="yield-stat-label">ZIP codes</div>
            </div>
          </div>
          <div class="yield-detail">
            <div class="yield-detail-row">
              <span>Expected return</span>
              <span class="green">+8%</span>
            </div>
            <div class="yield-detail-row">
              <span>Worst case (2005-level)</span>
              <span class="red">-15%</span>
            </div>
            <div class="yield-detail-row">
              <span>Historical avg loss</span>
              <span>-3.2%</span>
            </div>
          </div>
          <button class="btn btn-secondary" onclick="showYieldModal('basket')">Deposit USDC</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    This is not insurance. CatRisk is a prediction market protocol. Use at your own risk.
  </footer>

  <!-- Protection Modal -->
  <div class="modal-overlay" id="modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Buy Protection</div>
        <button class="modal-close" onclick="hideModal()">√ó</button>
      </div>

      <div class="input-group">
        <label class="input-label">Amount (USDC)</label>
        <input type="number" class="amount-input" id="amount" value="1000" onchange="updatePayout()">
      </div>

      <div class="payout-preview">
        <div class="payout-row">
          <span>You pay</span>
          <span id="pay-amount">$1,000</span>
        </div>
        <div class="payout-row">
          <span>Fee (1%)</span>
          <span id="fee-amount">$10</span>
        </div>
        <div class="payout-row">
          <span>If hurricane hits</span>
          <span class="green" id="payout-amount">$25,000</span>
        </div>
      </div>

      <button class="confirm-btn">Connect Wallet to Continue</button>
    </div>
  </div>

  <!-- Yield Modal -->
  <div class="modal-overlay" id="yield-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="yield-modal-title">Deposit to Basket</div>
        <button class="modal-close" onclick="hideYieldModal()">√ó</button>
      </div>

      <div class="basket-info" id="basket-info">
        <div class="basket-header">Diversified Basket</div>
        <div class="basket-desc">Your deposit is spread across 50+ coastal ZIP codes from Florida to Texas.</div>
        <div class="basket-zips">
          <span class="zip-tag">33139 Miami Beach</span>
          <span class="zip-tag">33101 Miami</span>
          <span class="zip-tag">33040 Key West</span>
          <span class="zip-tag">77058 Houston</span>
          <span class="zip-tag">+46 more</span>
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Deposit Amount (USDC)</label>
        <input type="number" class="amount-input" id="yield-amount" value="5000" onchange="updateYieldPreview()">
      </div>

      <div class="payout-preview" style="background: #eff6ff;">
        <div class="payout-row">
          <span>Your deposit</span>
          <span id="yield-deposit">$5,000</span>
        </div>
        <div class="payout-row">
          <span>Expected return (6 mo)</span>
          <span class="green" id="yield-return">+$400 (8%)</span>
        </div>
        <div class="payout-row">
          <span>Worst case (2005-level)</span>
          <span class="red" id="yield-worst">-$750 (-15%)</span>
        </div>
        <div class="payout-row" style="border-top: 1px solid #dbeafe; padding-top: 0.5rem;">
          <span>Unlock date</span>
          <span>Dec 15, 2026</span>
        </div>
      </div>

      <button class="confirm-btn" style="background: #2563eb;">Connect Wallet to Continue</button>
    </div>
  </div>

  <script>
    // State
    let currentLocation = { name: 'Miami Beach, FL', lat: 25.7907, lng: -80.1300 };
    let currentZip = '33139';
    let map, marker, circle;
    let mapInitialized = false;

    // Navigation functions
    function showLanding() {
      document.getElementById('landing').classList.remove('hidden');
      document.getElementById('protection-content').classList.remove('active');
      document.getElementById('yield-content').classList.remove('active');
    }

    function showProtection() {
      document.getElementById('landing').classList.add('hidden');
      document.getElementById('protection-content').classList.add('active');
      document.getElementById('yield-content').classList.remove('active');

      // Initialize map after it becomes visible
      setTimeout(() => {
        if (!mapInitialized) {
          initMap();
          mapInitialized = true;
        } else {
          map.invalidateSize();
        }
      }, 100);
    }

    function showYield() {
      document.getElementById('landing').classList.add('hidden');
      document.getElementById('protection-content').classList.remove('active');
      document.getElementById('yield-content').classList.add('active');
    }

    // Initialize map
    function initMap() {
      map = L.map('map').setView([currentLocation.lat, currentLocation.lng], 10);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
      }).addTo(map);

      marker = L.marker([currentLocation.lat, currentLocation.lng]).addTo(map);

      circle = L.circle([currentLocation.lat, currentLocation.lng], {
        color: '#f97316',
        fillColor: '#f97316',
        fillOpacity: 0.1,
        radius: 24140
      }).addTo(map);
    }

    // Search location using Nominatim API
    async function searchLocation() {
      const input = document.getElementById('address-input').value.trim();
      if (!input) return;

      document.getElementById('coverage-status').className = 'coverage-status';
      document.getElementById('coverage-status').innerHTML = '<span>Searching...</span>';
      document.getElementById('coverage-status').style.background = '#f3f4f6';
      document.getElementById('coverage-status').style.color = '#666';

      try {
        const query = input.match(/^\d{5}$/) ? `${input}, USA` : input;
        const response = await fetch(
          `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&countrycodes=us&limit=1`,
          { headers: { 'User-Agent': 'CatRisk Demo' } }
        );

        const data = await response.json();

        if (data && data.length > 0) {
          const result = data[0];
          currentLocation = {
            name: result.display_name.split(',').slice(0, 2).join(','),
            lat: parseFloat(result.lat),
            lng: parseFloat(result.lon)
          };
          currentZip = input.match(/^\d{5}$/) ? input : 'N/A';

          updateMap();

          document.getElementById('location-text').innerHTML =
            `${currentLocation.name} <span>${currentZip !== 'N/A' ? 'ZIP ' + currentZip : ''}</span>`;
          document.getElementById('coverage-status').className = 'coverage-status covered';
          document.getElementById('coverage-status').innerHTML =
            '<span class="status-icon">‚úì</span><span>Your address is within the coverage area</span>';
          document.getElementById('coverage-status').style.background = '';
          document.getElementById('coverage-status').style.color = '';
        } else {
          document.getElementById('coverage-status').className = 'coverage-status not-covered';
          document.getElementById('coverage-status').innerHTML =
            '<span class="status-icon">‚úó</span><span>Location not found. Try a US ZIP code or address.</span>';
          document.getElementById('coverage-status').style.background = '';
          document.getElementById('coverage-status').style.color = '';
        }
      } catch (error) {
        console.error('Geocoding error:', error);
        document.getElementById('coverage-status').className = 'coverage-status not-covered';
        document.getElementById('coverage-status').innerHTML =
          '<span class="status-icon">‚úó</span><span>Error searching. Please try again.</span>';
        document.getElementById('coverage-status').style.background = '';
        document.getElementById('coverage-status').style.color = '';
      }
    }

    function updateMap() {
      map.setView([currentLocation.lat, currentLocation.lng], 10);
      marker.setLatLng([currentLocation.lat, currentLocation.lng]);
      circle.setLatLng([currentLocation.lat, currentLocation.lng]);
    }

    // Allow Enter key to search
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('address-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') searchLocation();
      });
    });

    // Modal functions
    function showModal() {
      document.getElementById('modal').classList.add('show');
    }

    function hideModal() {
      document.getElementById('modal').classList.remove('show');
    }

    function updatePayout() {
      const amount = parseInt(document.getElementById('amount').value) || 0;
      const fee = amount * 0.01;
      const payout = amount * 25;

      document.getElementById('pay-amount').textContent = '$' + amount.toLocaleString();
      document.getElementById('fee-amount').textContent = '$' + fee.toLocaleString();
      document.getElementById('payout-amount').textContent = '$' + payout.toLocaleString();
    }

    document.getElementById('modal').addEventListener('click', function(e) {
      if (e.target === this) hideModal();
    });

    document.getElementById('yield-modal').addEventListener('click', function(e) {
      if (e.target === this) hideYieldModal();
    });

    // Yield Modal
    function showYieldModal(type) {
      const modal = document.getElementById('yield-modal');
      const title = document.getElementById('yield-modal-title');
      const basketInfo = document.getElementById('basket-info');

      if (type === 'basket') {
        title.textContent = 'Deposit to Diversified Basket';
        basketInfo.style.display = 'block';
      } else {
        title.textContent = 'Deposit to Single ZIP';
        basketInfo.style.display = 'none';
      }

      modal.classList.add('show');
      updateYieldPreview();
    }

    function hideYieldModal() {
      document.getElementById('yield-modal').classList.remove('show');
    }

    function updateYieldPreview() {
      const amount = parseInt(document.getElementById('yield-amount').value) || 0;
      const expectedReturn = amount * 0.08;
      const worstCase = amount * -0.15;

      document.getElementById('yield-deposit').textContent = '$' + amount.toLocaleString();
      document.getElementById('yield-return').textContent = '+$' + expectedReturn.toLocaleString() + ' (8%)';
      document.getElementById('yield-worst').textContent = '-$' + Math.abs(worstCase).toLocaleString() + ' (-15%)';
    }
  </script>
</body>
</html>
